---
title: "MB5370 Module 04. Workshop 2 - Using ggplot2 for communication"
author: "Heather Brock"
output: html_document
date: "2025-09-10"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Setup

```{r}
library("tidyverse")
mpg
```

# Labels

Adding a title to a plot can help communicate the main takeaway.

```{r}
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(color = class)) +
  geom_smooth(se.e = FALSE) +
  labs(title = "Fuel efficiency generally decreases with engine size")
```
Captions and subtitles can provide additional context.

```{r}
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(color = class)) +
  geom_smooth(se = FALSE) +
  labs(
    title = "Fuel efficiency generally decreases with engine size",
    subtitle = "Two seaters (sports cars) are an exception because of their light weight",
    caption = "Data from fueleconomy.gov"
  )
```

Axis labels can be customized to be more descriptive by using labs().

```{r}
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(colour = class)) +
  geom_smooth(se = FALSE) +
  labs(
    x = "Engine displacement (L)",
    y = "Highway fuel economy (mpg)",
    colour = "Car type"
  )
```

# Annotations

Annotations can be used to highlight specific points or areas of interest. Use geom_text() to add textual annotations.

```{r}
best_in_class <- mpg %>%
  group_by(class) %>%
  filter(row_number(desc(hwy)) == 1)

ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(colour = class)) +
  geom_text(aes(label = model), data = best_in_class)
```
If the labels overlap, nudge() can be used to move the labels.

# Scales

ggplot2 automatically adds scales to plots, but scales can be adjusted to improve readability. For example, changing the color palette.

This is what gglopt2 gives you by default:
```{r}
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(colour = class))
```

You can change the scale by adding values to the scale parameter.

```{r}
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(colour = class)) +
  scale_x_continuous(limits = c(0,12)) +
  scale_y_continuous(limits = c(0,12)) +
  scale_colour_discrete(limits = c(0,12))
```

# Axis Ticks

You can also change the ticks on your axes. Breaks controls the position of the ticks and you can use labels as an argument to change the text label associated with ticks.

```{r}
ggplot(mpg, aes(displ, hwy)) +
  geom_point() +
  scale_y_continuous(breaks = seq(15, 40, by = 5))
```

Similarly, you can use labels set to NULL to suppress the labels altogether. This is sometimes an option if you’re trying to format your plots in a particular way. 

```{r}
ggplot(mpg, aes(displ, hwy)) +
  geom_point() +
  scale_x_continuous(labels = NULL) +
  scale_y_continuous(labels = NULL)
```

# Legends and Colour Schemes

Legends can be customized to improve clarity. You can change the position of the legend using theme().

```{r}
base <- ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(colour = class))

base + theme(legend.position = "left")
base + theme(legend.position = "top")
base + theme(legend.position = "bottom")
base + theme(legend.position = "right") # the default
```

You can also remove the legend entirely if it’s not necessary for understanding the plot by using legend.position = "none".

```{r}
base <- ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(colour = class))

base + theme(legend.position = "none")
```

# Replacing a Scale

There are two types of scales you’re mostly likely to want to switch out: continuous position scales and colour scales.

It’s very useful to plot transformations of your variables. For example, as we’ve seen in diamond prices it’s easier to see the precise relationship between carat and price if we log transform them using a ggplot2 function for scale precisely for this purpose.

```{r}
ggplot(diamonds, aes(carat, price)) +
  geom_bin2d() + 
  scale_x_log10() + 
  scale_y_log10()
```

You can also change the colour scale.

```{r}
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(color = drv))

ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(color = drv)) +
  scale_colour_brewer(palette = "Set1")
```

If there are just a few colours, you can add a redundant shape mapping. This will also help ensure your plot is interpretable in black and white.

```{r}
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(color = drv, shape = drv)) +
  scale_colour_brewer(palette = "Set1")
```

These are helpful links for selecting colour schemes:
http://colorbrewer2.org/
http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/

When you have predefined colours you want to use you can set them yourself, using scale_colour_manual()

```{r}
presidential %>%
  mutate(id = 33 + row_number()) %>%
  ggplot(aes(start, id, colour = party)) +
    geom_point() +
    geom_segment(aes(xend = end, yend = id)) +
    scale_colour_manual(values = c(Republican = "red", Democratic = "blue"))
```

One of the best colour schemes to use now is the viridis scheme. To use it, simply use scale_colour_viridis() provided by the viridis package.

```{r}
#install.packages('viridis')
#install.packages('hexbin')
library(viridis)
library(hexbin)
```

Example:
```{r}
df <- tibble( # note we're just making a fake dataset so we can plot it
  x = rnorm(10000),
  y = rnorm(10000)
)
ggplot(df, aes(x, y)) +
  geom_hex() + # a new geom!
  coord_fixed()

ggplot(df, aes(x, y)) +
  geom_hex() +
  viridis::scale_fill_viridis() +
  coord_fixed()
```

There are other colour schemes that can be installed.

```{r}
#install.packages("wesanderson")
library(wesanderson)
```

# Themes

And finally, now you can customize the entire theme of your plot. Themes allow you to change some or all of the non-data elements of your plot with a theme.
ggplot2 has eight themes by default. Many more are included in add-on packages like ggthemes (https://github.com/jrnold/ggthemes), by Jeffrey Arnold.

```{r}
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(color = class)) +
  geom_smooth(se = FALSE) +
  theme_bw()
```

```{r}
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(color = class)) +
  geom_smooth(se = FALSE) +
  theme_light()
```

```{r}
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(color = class)) +
  geom_smooth(se = FALSE) +
  theme_classic()
```

```{r}
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(color = class)) +
  geom_smooth(se = FALSE) +
  theme_dark()
```

One particularly nice thing you can do is to develop your own themes simply by setting some or all of the arguments to theme() yourself. Here’s one I wrote so that my plots are always the same style:

```{r}
ggplot(mpg, aes(displ, hwy)) +
  geom_point(aes(color = class)) +
  geom_smooth(se = FALSE) + 
theme (panel.border = element_blank(),
        panel.grid.minor.x = element_blank(),
        panel.grid.minor.y = element_blank(),
        legend.position="bottom",
        legend.title=element_blank(),
        legend.text=element_text(size=8),
        panel.grid.major = element_blank(),
        legend.key = element_blank(),
        legend.background = element_blank(),
        axis.text.y=element_text(colour="black"),
        axis.text.x=element_text(colour="black"),
        text=element_text(family="Arial")) 
```

# Saving and Exporting Plots

Now that you've iteratively developed your plot, you want to save it to disk in some format that allows you to import it into your report or to share it with the world. 
In general, the best way to make a single file will be to export it using the ggsave() function. 
There are two main ways to get your plots out of R using ggplot2. ggsave() will save the most recent plot to your working directory. 

```{r}
ggplot(mpg, aes(displ, hwy)) + geom_point()

ggsave("my-plot.pdf")
#> Saving 7 x 4.32 in image
```

Sometimes, you’ll want to play with the dimensions of your plot, in which case you can use the width and height arguments to this function.

Note that you can alternatively export your results, together with your code, using R markdown via knitr. 